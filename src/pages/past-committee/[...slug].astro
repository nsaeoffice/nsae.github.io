---
import { type CollectionEntry, getCollection } from "astro:content";
import { Image } from "astro:assets";
import PageLayout from "@/layouts/PageLayout.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

export async function getStaticPaths() {
  const committees = await getCollection("committees", ({ data }) => {
    // In production, filter out drafts.
    return import.meta.env.MODE !== "production" || data.draft === false;
  });

  return committees.map((committee) => ({
    params: { slug: committee.id },
    props: committee,
  }));
}
type Props = CollectionEntry<"committees">;

const committee = Astro.props;
const members = committee.data.committeeMembers;

function formatPosition(position: string) {
  return position
    .split("-")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
}
---

<PageLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <main class="container mx-auto p-8">
    <h1 class="text-4xl font-bold mb-8 text-center">{committee.data.title}</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
      {
        members.map((member) => (
          <div class="relative overflow-hidden rounded-lg shadow-lg group">
            {member.profileImage ? (
              <Image
                src={member.profileImage}
                inferSize
                alt={`Profile picture of ${member.name}`}
                class="aspect-3/4 w-full object-cover transition-transform duration-300 group-hover:scale-105"
              />
            ) : (
              <div class="aspect-3/4 w-full bg-secondary flex items-center justify-center" />
            )}

            <div class="absolute bottom-4 right-4 bg-black/70 p-3 rounded-md text-white">
              <span class="block text-sm font-semibold">{member.name}</span>
              <span class="block text-xs">
                {formatPosition(member.position)}
              </span>
            </div>
          </div>
        ))
      }
    </div>
  </main>
</PageLayout>
