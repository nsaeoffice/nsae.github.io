---
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import PageLayout from "@/layouts/PageLayout.astro";

import Faq from "@/components/sections/Faq.astro";
import BlogsArchive from "@/components/sections/BlogsArchive.astro";
import BannersArchive from "@/components/sections/BannersArchive.astro";
import MissionBrief from "@/components/sections/MissionBrief.astro";
import Memberships from "@/components/sections/Memberships.astro";

import AnnouncementRibbon from "@/components/astro/AnnouncementRibbon.astro";
import { getCollection } from "astro:content";
import HomeHero from "@/components/sections/HomeHero.astro";

const allNotices = await getCollection("posts", ({ data }) => {
  return (
    (import.meta.env.MODE !== "production" || data.draft === false) &&
    data.type === "notice"
  );
});

// Sort by date (newest first) and grab the first one
const latestNotice = allNotices.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)[0];
---

<PageLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  {
    latestNotice && (
      <AnnouncementRibbon
        id={latestNotice.id}
        label="Latest Update"
        message={latestNotice.data.title}
        href={`/${latestNotice.id}/`}
      />
    )
  }
  <HomeHero />

  <MissionBrief />
  <Memberships />
  <BannersArchive />
  <BlogsArchive />
  <Faq />
</PageLayout>
