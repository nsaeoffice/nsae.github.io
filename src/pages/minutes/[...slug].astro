---
import { type CollectionEntry, getCollection, render } from "astro:content";
import PageLayout from "@/layouts/PageLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import Badge from "@/components/astro/Badge.astro";
import ArrowLeft from "@tabler/icons/outline/arrow-left.svg";
import Download from "@tabler/icons/outline/download.svg";
import Point from "@tabler/icons/outline/point.svg";
import MapPin from "@tabler/icons/outline/map-pin.svg";
import CalendarWeek from "@tabler/icons/outline/calendar-week.svg";

export async function getStaticPaths() {
  const posts = await getCollection("minutes");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<"minutes">;
const post = Astro.props;
const { Content } = await render(post);
const {
  title,
  pubDate,
  type,
  location,
  chairperson,
  secretary,
  attendees,
  downloadUrl,
} = post.data;
---

<PageLayout title={title} description={`Minutes for ${title}`}>
  <article class="py-8 space-y-8">
    <header class="space-y-6 border-b pb-4">
      <a
        href="/minutes"
        class="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors"
      >
        <ArrowLeft class="size-4" /> Back to All Minutes
      </a>
      <div class="space-y-2 text-center">
        <div class="flex items-center gap-4 justify-center">
          <Badge variant={"secondary"} size={"xs"} class={"capitalize"}>
            <Point class="fill-destructive text-destructive w-4 h-4" />
            {type}
          </Badge>
          <span
            class="flex flex-row gap-1 items-center text-muted-foreground text-sm"
          >
            <CalendarWeek class={"size-4"} />
            <FormattedDate date={pubDate} />
          </span>
          <span
            class="flex flex-row gap-1 items-center text-muted-foreground text-sm"
          >
            <MapPin class={"size-4"} />
            {location}
          </span>
        </div>
        <h1
          class="text-3xl md:text-4xl font-bold tracking-tight first-letter:capitalize"
        >
          {title}
        </h1>
      </div>

      <div
        class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 bg-secondary p-4 rounded-lg text-sm"
      >
        {
          chairperson && (
            <div>
              <span class="font-semibold block text-foreground">
                Chairperson:
              </span>
              {chairperson}
            </div>
          )
        }
        {
          secretary && (
            <div>
              <span class="font-semibold block text-foreground">
                Secretary:
              </span>{" "}
              {secretary}
            </div>
          )
        }
        {
          attendees && attendees.length > 0 && (
            <div class="md:col-span-2">
              <span class="font-semibold block text-foreground">
                Attendees:
              </span>
              <span class="text-muted-foreground">{attendees.join(", ")}</span>
            </div>
          )
        }
      </div>

      {
        downloadUrl && (
          <a
            href={downloadUrl}
            target="_blank"
            class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"
          >
            <Download class="size-4" /> Download PDF
          </a>
        )
      }
    </header>

    <div class="prose max-w-6xl mx-auto dark:prose-invert">
      <Content />
    </div>
  </article>
</PageLayout>
